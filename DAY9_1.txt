Functions

1. Write a program to take the input as empno and return the experience of employee in terms of number of years.

SOLUTION:-

	CREATE FUNCTION f1(EMP_ID INT)
	RETURNS INT
	READS SQL DATA
	DETERMINISTIC
	BEGIN
	DECLARE EXP_IN_YEARS INT;
	SELECT YEAR(CURDATE())-YEAR(HIREDATE) INTO EXP_IN_YEARS FROM emp WHERE EMPNO=EMP_ID;
	RETURN EXP_IN_YEARS;
	END//
	
2. Write a program to take the input as deptno and return the comma separated list of employee names

SOLUTION:-

	CREATE FUNCTION f2(DEPT_NO INT)
	RETURNS VARCHAR(300)
	READS SQL DATA
	DETERMINISTIC
	BEGIN
	DECLARE EMPS_NAME VARCHAR(300);
	DECLARE EMP_NAME VARCHAR(20);
	DECLARE RESULT VARCHAR(300);
	DECLARE RECORD_COUNT INT;	
	DECLARE CUR CURSOR FOR SELECT ENAME FROM emp WHERE DEPTNO=DEPT_NO;
	SELECT COUNT(*) INTO RECORD_COUNT FROM emp WHERE DEPTNO=DEPT_NO; 
	SET EMPS_NAME = '';
	OPEN CUR;
	EMP_LOOP : LOOP
	IF RECORD_COUNT=0 THEN
	LEAVE EMP_LOOP;
	END IF;
	FETCH CUR INTO EMP_NAME;
	SET EMPS_NAME = CONCAT(EMP_NAME,", ",EMPS_NAME); 
	SET RECORD_COUNT = RECORD_COUNT - 1;
	END LOOP EMP_LOOP;
	CLOSE CUR;
	SELECT EMPS_NAME INTO RESULT;
	RETURN RESULT;
	END //


3. Add a new column incentive to emp table. Write a program to calculate and update the incentive using following logic.
     If employees salary is more then avg salary of dept then incentive is 0
	 If employees salary is less then avg salary of dept then incentive is 10% of salary

SOLUTION:-

	CREATE PROCEDURE p18()
	BEGIN
	DECLARE AVG_SAL,RECORD_COUNT,EMP_SAL,EMP_ID,INCENTIVE INT;
	CREATE TEMPORARY TABLE emp2(EMPNO INT, ENAME VARCHAR(20), JOB VARCHAR(20), MGR INT, HIREDATE DATE, SAL INT, COMM INT, DEPTNO INT);
	INSERT INTO emp2 SELECT * FROM emp;
	ALTER TABLE emp2 ADD incentives INT;
	SELECT AVG(SAL) INTO AVG_SAL FROM emp;
	BEGIN
	DECLARE CUR CURSOR FOR SELECT EMPNO,SAL FROM emp;
	SELECT COUNT(*) INTO RECORD_COUNT FROM emp;
	OPEN CUR;
	MY_LOOP : LOOP
	IF RECORD_COUNT=0 THEN
	LEAVE MY_LOOP;
	END IF;
	FETCH CUR INTO EMP_ID,EMP_SAL;
	IF EMP_SAL > AVG_SAL THEN
	SET INCENTIVE = 0;
	ELSE
	SET INCENTIVE = 1.1 * EMP_SAL;
	END IF;
	UPDATE emp2 SET incentives=INCENTIVE WHERE EMPNO=EMP_ID;
	SET RECORD_COUNT = RECORD_COUNT - 1;
	END LOOP MY_LOOP;
	CLOSE CUR;
	END;
	SELECT * FROM emp2;
	DROP TABLE emp2;
	END //
	
	
4. Write a program to get the count of employees working in provided deptno

SOLUTION:-

	CREATE FUNCTION f3(DEPT_NUM INT)
	RETURNS INT
	READS SQL DATA
	DETERMINISTIC
	BEGIN
	DECLARE EMP_COUNT INT;
	SELECT COUNT(*) INTO EMP_COUNT FROM emp WHERE DEPTNO=DEPT_NUM;
	RETURN EMP_COUNT;
	END//